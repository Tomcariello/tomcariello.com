<section class="main">
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>

  <form enctype="multipart/form-data" action="updateAboutMe" onsubmit="return validateAboutMeForm()" method="POST">
    <div class='row'>
      <div class="col-sm-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3>Update About Me Information</h3>
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-sm-12">
                <p>About Me (limit 10,000 characters):</p>
              </div>
            </div>
        
            {{!-- Hidden element to contain encoded text for form submission --}}
            <div class="hideElement adminTextArea col-md-12">      
              <textarea rows="4" cols="50" id="AboutMe" name="AboutMe" maxlength="1000">{{dynamicData.bio}}</textarea> 
            </div>
            <div class="row">
              <div class="col-md-8">
                <div class="row">
                  <div id="summernoteAboutMe" data-id="1">
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class='col-sm-2'>
                <p>Image:</p>
                <input type="file" name="profilepicture" id="profilepicture">
                {{!-- <input type="text" id="AboutMeImage" name="AboutMeImage" value="{{dynamicData.image}}"/> --}}
                <label for="profilepicture" class="labelButton">Select file</label>
              </div>
              <div class='col-sm-10'>
                <img class="aboutAdminImage" src="{{dynamicData.image}}">
              </div>
            </div>
            
            <div class="row imageCaptionRow">
              <div class="col-sm-12">
                <p>Image Caption:</p>
              </div>
            </div>


            {{!-- Hidden element to contain encoded text for form submission of AboutMeCaption --}}
            <div class="hideElement adminTextArea col-md-12">      
              <textarea rows="4" cols="50" id="AboutMeCaption" name="AboutMeCaption" maxlength="1000">{{dynamicData.caption}}</textarea> 
            </div>
            {{!-- Visible WYSYWIG Editor for AboutMeCaption --}}
            <div class="row">
              <div class="col-md-8">
                <div class="row">
                  <div id="summernoteAboutMeCaption" data-id="2">
                  </div>
                </div>
              </div>
            </div>
          </div>  
        </div>
      </div>
    </div>

    <div class='row'>
      <div class="col-sm-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3>Update About This Page Information</h3>
          </div>
          <div class="panel-body">
              <div class="row">
                <div class="col-sm-12">
                  <p>About Me (limit 10,000 characters):</p>
                </div>
              </div>
          
              {{!-- Hidden element to contain encoded text for form submission --}}
              <div class="hideElement adminTextArea col-md-12">      
                <textarea rows="4" cols="50" id="AboutPage" name="AboutPage" maxlength="1000">{{dynamicData.aboutpagetext}}</textarea> 
              </div>
              <div class="row">
                <div class="col-md-8">
                  <div class="row">
                    <div id="summernoteAboutPage" data-id="3">
                    </div>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class='col-sm-2'>
                  <p>Image:</p>
                  <input type="file" name="aboutpagepicture" id="aboutpagepicture">
                  <input type="text" id="AboutPageImage" name="AboutPageImage" value="{{dynamicData.aboutpageimage}}"/>
                  <label for="aboutpagepicture" class="labelButton">Select file</label>
                </div>
                <div class='col-sm-10'>
                  <img class="aboutAdminImage" src="{{dynamicData.aboutpageimage}}">
                </div>
              </div>
              
              <div class="row imageCaptionRow">
                <div class="col-sm-12">
                  <p>Image Caption:</p>
                </div>
              </div>


              {{!-- Hidden element to contain encoded text for form submission of AboutPageCaption --}}
              <div class="hideElement adminTextArea col-md-12">      
                <textarea rows="4" cols="50" id="AboutPageCaption" name="AboutPageCaption" maxlength="1000">{{dynamicData.aboutpagecaption}}</textarea> 
              </div>
              {{!-- Visible WYSYWIG Editor for AboutPageCaption --}}
              <div class="row">
                <div class="col-md-8">
                  <div class="row">
                    <div id="summernoteAboutPageCaption" data-id="4">
                    </div>
                  </div>
                </div>
              </div>


              <div class="row">
                <div class='col-sm-12'>
                  <p><button type="submit" id="update" class="blueButton">Update About Me</button></p>
                </div>
              </div>
          </div>  
        </div>
      </div>
    </div>
  </form>

  <script>
    $(document).ready(function() {
      const summernoteConfig = {
        fontNames: ["Arial", "Arial Black", "Courier New", "Helvetica", "Impact", "Tahoma", "Times New Roman", "Verdana"],
        fontNamesIgnoreCheck: ["Arial", "Arial Black", "Courier New", "Helvetica", "Impact", "Tahoma", "Times New Roman", "Verdana"],
        toolbar: [
          ['style', ['bold', 'italic', 'underline', 'clear']],
          ['font', ['strikethrough', 'superscript', 'subscript']],
          ['fontsize', ['fontsize']],
          ["fontname", ["fontname"]],
          ['para', ['ul', 'ol', 'paragraph']],
          ['height', ['height']],
          ['insert', ['link']],
          ['view', ['codeview']]
        ]
      };

      const summerNoteEditors = [
        { editor: '#summernoteAboutMe', input: '#AboutMe' },
        { editor: '#summernoteAboutMeCaption', input: '#AboutMeCaption' },
        { editor: '#summernoteAboutPage', input: '#AboutPage' },
        { editor: '#summernoteAboutPageCaption', input: '#AboutPageCaption' }
      ];

      summerNoteEditors.forEach(({ editor, input }) => {
        const $editor = $(editor); // Summernote still needs the jQuery selector internally
        const inputEl = document.querySelector(input);

        $editor.summernote(summernoteConfig);

        // Decode and Set Initial Content
        if (inputEl && inputEl.value) {
          const decodedContent = decodeURI(inputEl.value);
          $editor.summernote('code', decodedContent);
        }
      });
    });

    function validateAboutMeForm() {
      const summerNoteEditors = [
        { editor: '#summernoteAboutMe', input: '#AboutMe' },
        { editor: '#summernoteAboutMeCaption', input: '#AboutMeCaption' },
        { editor: '#summernoteAboutPage', input: '#AboutPage' },
        { editor: '#summernoteAboutPageCaption', input: '#AboutPageCaption' }
      ];

      summerNoteEditors.forEach(({ editor, input }) => {
        const formattedData = $(editor).summernote('code');
        const encodedData = encodeURI(formattedData);
        document.querySelector(input).value = encodedData;
      });

      return true;
    }
  </script>
</section>