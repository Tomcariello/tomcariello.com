<section class="page-admin-about">
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>

  <div class="admin-header mb-4">
    <h2 class="fw-bold">Update About Information</h2>
    <p class="text-secondary">Modify your bio and the "About This Page" technical section.</p>
  </div>

  <form enctype="multipart/form-data" action="updateAboutMe" onsubmit="return validateAboutMeForm()" method="POST">
    
    <div class="card border-0 shadow-sm rounded-4 mb-4">
      <div class="card-header bg-white py-3 border-bottom">
        <h5 class="mb-0 fw-bold text-primary"><i class="fas fa-user-edit me-2"></i>Personal Bio</h5>
      </div>
      <div class="card-body p-4">
        
        <div class="mb-4">
          <label class="form-label fw-bold">About Me Content</label>
          <div id="summernoteAboutMe"></div>
          <textarea class="d-none" id="AboutMe" name="AboutMe">{{dynamicData.bio}}</textarea> 
        </div>

        <div class="row align-items-center mb-4">
          <div class="col-md-7">
            <label class="form-label fw-bold d-block">Profile Image</label>
            
            <div class="d-flex align-items-center gap-3">
              <input type="file" class="d-none" name="profilepicture" id="profilepicture" onchange="updateFileName(this, 'profile-file-name')">
              
              <button type="button" class="btn btn-outline-primary btn-sm rounded-pill px-3" onclick="document.getElementById('profilepicture').click()">
                <i class="fas fa-sync-alt me-1"></i> Replace Photo
              </button>

              <span id="profile-file-name" class="small text-muted italic">Existing file: profile.jpg</span>
            </div>
            
            <div class="form-text mt-2">Uploading a new file will overwrite the current image.</div>
          </div>

          <div class="col-md-5 text-center text-md-end">
            <div class="current-img-preview">
              <small class="d-block text-uppercase text-muted fw-bold mb-1" style="font-size: 0.65rem;">Currently Active</small>
              <img class="img-thumbnail rounded-circle" src="{{dynamicData.image}}" style="width: 100px; height: 100px; object-fit: cover;">
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card border-0 shadow-sm rounded-4 mb-5">
      <div class="card-header bg-white py-3 border-bottom">
        <h5 class="mb-0 fw-bold text-success"><i class="fas fa-code me-2"></i>About This Page</h5>
      </div>
      <div class="card-body p-4">
        
        <div class="mb-4">
          <label class="form-label fw-bold">Technical Description</label>
          <div id="summernoteAboutPage"></div>
          <textarea class="d-none" id="AboutPage" name="AboutPage">{{dynamicData.aboutpagetext}}</textarea> 
        </div>

        <div class="row align-items-center mb-4">
          <div class="col-md-7">
            <label class="form-label fw-bold d-block">Tech Stack Illustration</label>
            
            <div class="d-flex align-items-center gap-3">
              <input type="file" class="d-none" name="aboutpagepicture" id="aboutpagepicture" onchange="updateFileName(this, 'tech-file-name')">
              
              <button type="button" class="btn btn-outline-success btn-sm rounded-pill px-3" onclick="document.getElementById('aboutpagepicture').click()">
                <i class="fas fa-upload me-1"></i> Replace Tech Image
              </button>

              <span id="tech-file-name" class="small text-muted italic">Existing file: tech-stack.png</span>
            </div>
            <div class="form-text mt-2">Recommended: Landscape orientation (e.g., 1200x800).</div>
          </div>

          <div class="col-md-5 text-center text-md-end">
            <div class="current-img-preview tech-preview">
              <small class="d-block text-uppercase text-muted fw-bold mb-1" style="font-size: 0.65rem;">Currently Active</small>
              <img class="img-thumbnail rounded-3" src="{{dynamicData.aboutpageimage}}" style="width: 150px; height: auto; max-height: 100px; object-fit: contain; background: #fff;">
            </div>
          </div>
        </div>

        <div class="mb-2">
          <label class="form-label fw-bold">Tech Image Caption</label>
          <div id="summernoteAboutPageCaption"></div>
          <textarea class="d-none" id="AboutPageCaption" name="AboutPageCaption">{{dynamicData.aboutpagecaption}}</textarea>
        </div>
      </div>
    </div>

    <div class="admin-sticky-actions bg-white border-top p-3 text-end shadow-sm">
      <a href="/adminportal" class="btn btn-outline-secondary rounded-pill px-4 me-2">Cancel</a>
      <button type="submit" id="update" class="btn btn-primary rounded-pill px-5 fw-bold shadow">Save All Changes</button>
    </div>

  </form>
  <script>
  $(document).ready(function() {
    // 1. Summernote Configuration
    const summernoteConfig = {
      height: 250, // Added a default height so it doesn't look collapsed
      fontNames: ["Arial", "Arial Black", "Courier New", "Helvetica", "Impact", "Tahoma", "Times New Roman", "Verdana"],
      fontNamesIgnoreCheck: ["Arial", "Arial Black", "Courier New", "Helvetica", "Impact", "Tahoma", "Times New Roman", "Verdana"],
      toolbar: [
        ['style', ['bold', 'italic', 'underline', 'clear']],
        ['font', ['strikethrough', 'superscript', 'subscript']],
        ['fontsize', ['fontsize']],
        ["fontname", ["fontname"]],
        ['para', ['ul', 'ol', 'paragraph']],
        ['height', ['height']],
        ['insert', ['link']],
        ['view', ['codeview']]
      ]
    };

    // 2. Editor Mapping
    const summerNoteEditors = [
      { editor: '#summernoteAboutMe', input: '#AboutMe' },
      { editor: '#summernoteAboutMeCaption', input: '#AboutMeCaption' },
      { editor: '#summernoteAboutPage', input: '#AboutPage' },
      { editor: '#summernoteAboutPageCaption', input: '#AboutPageCaption' }
    ];

    // 3. Initialize and Load Data
    summerNoteEditors.forEach(({ editor, input }) => {
      const $editor = $(editor);
      const inputEl = document.querySelector(input);

      $editor.summernote(summernoteConfig);

      // Populate with existing data from DB
      if (inputEl && inputEl.value) {
        try {
          // Changed to decodeURIComponent to handle complex HTML strings better
          const decodedContent = decodeURIComponent(inputEl.value);
          $editor.summernote('code', decodedContent);
        } catch (e) {
          // Fallback to your original decodeURI if the encoding format differs
          $editor.summernote('code', decodeURI(inputEl.value));
        }
      }
    });
  });

  // 4. Form Validation & Data Preparation for POST
  function validateAboutMeForm() {
    const summerNoteEditors = [
      { editor: '#summernoteAboutMe', input: '#AboutMe' },
      { editor: '#summernoteAboutMeCaption', input: '#AboutMeCaption' },
      { editor: '#summernoteAboutPage', input: '#AboutPage' },
      { editor: '#summernoteAboutPageCaption', input: '#AboutPageCaption' }
    ];

    summerNoteEditors.forEach(({ editor, input }) => {
      const formattedData = $(editor).summernote('code');
      // Syncing the editor back to the hidden textarea for submission
      document.querySelector(input).value = encodeURIComponent(formattedData);
    });

    return true;
  }
</script>
</section>